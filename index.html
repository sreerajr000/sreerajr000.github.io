<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<title>Image Classifier</title>
	</head>
<body>
	<script type="text/javascript">
		var filenum = 1;
		var data = {};
		var filename = new Date();
		var githubApi = {};
		githubApi.header = {};
		githubApi.header.Accept = "application/vnd.github.v3+json"; //make sure we use v3
		githubApi.header.Authorization = "token be8fd1ea7abb1be34d60d34a8a43efb7d87039bc";
		githubApi.baseUrl = "https://api.github.com";
		githubApi.username = "sreerajr000";
		githubApi.nameRepo = "temporaryrepo";
		githubApi.sha = "";
		githubApi.path = "";
		githubApi.newFile = false;
		function nextImage() {
			var json = JSON.stringify(data);
			//fs.writeFile(time + '.json',json, 'utf8', callback);
			var filename = "faces/" + filenum + ".jpg";
			filenum++;
		    document.getElementById("image").src = filename;
		    console.log(data);
		}
		function happy() {
			data[filenum] = 0;
			nextImage();
		}
		function sad() {
			data[filenum] = 1;
			nextImage();
		}
		function neutral() {
			data[filenum] = 2;
			nextImage();
		}
		function nai() {
			data[filenum] = 10;
			nextImage();
		}
		function apiRequest(method, url, jsonData, callback) {
			//load the json file
			var xhr = new XMLHttpRequest();
			
			xhr.onreadystatechange = function() {
			    if (xhr.readyState == 4 ){
			    	if(xhr.status == 200 || xhr.status == 201) {
			        	callback(xhr.responseText);
			        }
			        else {
			        	console.log(xhr.status);
			        	console.log(xhr.responseText);
			        }
			    }
			}
			xhr.open(method, url, true);
			for(var key in githubApi.header) {
				xhr.setRequestHeader(key, githubApi.header[key]);
			}
			xhr.send(jsonData);
		}
		
		function newFile() {
			
			githubApi.newFile = true;
			githubApi.path = filename;
			console.log(filename);
			//document.getElementById("content").value = ""; //clear
			//document.getElementById("pathTitle").value = githubApi.path;
			commitAndPush();
		}
		function commitAndPush() {
			var jsonData = new Object();
			jsonData.message = filename;
			//jsonData.content = btoa(document.getElementById("content").value); //encode64
			jsonData.content = btoa(JSON.stringify(data));
			jsonData.path = githubApi.path;
			jsonData.branch = "master";
			if(!githubApi.newFile) {
				jsonData.sha = githubApi.sha;
			}
			var url = "https://api.github.com/repos/sreerajr000/sreerajr000.github.io/contents/"+githubApi.path;
			jsonData = JSON.stringify(jsonData); //api expects json as string
			console.log(jsonData);
			apiRequest("PUT", url, jsonData, function(r) {
				//cout(r);
				console.log(r);
			});
		}
	</script>


	<div class="container-fluid">
		<div class="row" style="height:150px;">
			<div class="col-sm-4">
				<div class="form-group">
				  <label for="usr">Start from sample No.</label>
				  <input type="text" class="form-control" id="usr" style="width:120px;">
				</div>
			</div>
			<div class="col-sm-4" style="text-align: center;">
				<h2>Image Classifier</h2>
			</div>
			<div class="col-sm-4"></div>
		</div>
		<div id="imageframe" class="row" style="height:300px;"> 
			<div class="col-sm-4"></div>
			<div class="col-sm-4" style="text-align: center;">
				<img id="image" src="faces/0.jpg">
			</div>
			<div class="col-sm-4"></div>
		</div>
		<div class="row">
			<div class="col-sm-1">
				<button type="button" class="btn btn-success" onclick="happy()">Happy</button>
			</div>
			<div class="col-sm-1"></div>
			<div class="col-sm-1"></div>
			<div class="col-sm-1"></div>
			<div class="col-sm-1">
				<button type="button" class="btn btn-success" onclick="sad()">Sad</button>
			</div>
			<div class="col-sm-1"></div>
			<div class="col-sm-1"></div>
			<div class="col-sm-1"></div>
			<div class="col-sm-1">
				<button type="button" class="btn btn-success" onclick="neutral()">Neutral</button>
			</div>
			<div class="col-sm-1"></div>
			<div class="col-sm-1"></div>
			<div class="col-sm-1">
				<button type="button" class="btn btn-success" onclick="nai()">Not an Image</button>
			</div>
			
		</div>
		<div class="row">
			<div class="col-sm-12" style="text-align:center;">
				<button id="send" type="button" class="btn btn-success" onclick="newFile()">Send Results</button>
			</div>
		</div>
	</div>
</body>
</html>